<?php

namespace app\components;

use app\models\billing\Contract;
use app\models\billing\Payer;
use app\models\billing\Invoice as DtmInvoice;
use app\models\billing\Service;
use app\models\person\Person;
use yii\base\BaseObject;
use yii\base\Component;
use yii\httpclient\Client;

class Invoice extends Component
{
    public function createInvoice($imie, $service_id, $abitur_id)
    {
        $invoice = DtmInvoice::find()->where(['imie' => $imie])->andWhere(['service_id' => $service_id])->andWhere(['abitur_id' => (string)$abitur_id])->asArray()->one();
//        prd($invoice);
        if (isset($invoice) && !empty($invoice)) {
            return ['status' => 1, 'serial' => $invoice['serial'], 'pay' => $invoice['pay']];
        } else {
            $person = self::getPerson($imie);
            if (isset($person)) {
                $response = self::billingGetPayer($person);
                if (isset($response) && !empty($response)) {
                    $payer = self::createPayer($response, $imie);
                    if (isset($payer) && !empty($payer)) {
                        $invoice = self::billingGetInvoice($service_id, $payer);
                        if (isset($invoice) && !empty($invoice)) {
                            $dtm_invoice = self::createIn( $imie, $service_id,$abitur_id,$payer->id, $invoice);
                            if (isset($dtm_invoice)) {
                                return ['status' => 1, 'serial' => $dtm_invoice['serial'],'fee'=>$dtm_invoice['fee']];
                            }
                        }
                    }
                }
            }
        }
    }

    public function createContractInvoice($imie, $service_id, $abitur_id, $summ)
    {
        $invoice = DtmInvoice::find()->where(['imie' => $imie])->andWhere(['service_id' => $service_id])->andWhere(['abitur_id' =>$abitur_id])->asArray()->one();
        if (isset($invoice) && !empty($invoice)) {
            return ['status' => 1, 'serial' => $invoice['serial'], 'pay' => $invoice['pay']];
        } else {
            $person = self::getPerson($imie);

            if (isset($person)) {
                $response = self::billingGetPayer($person);

                if (isset($response) && !empty($response)) {
                    $payer = self::createPayer($response, $imie);
                    if (isset($payer) && !empty($payer)) {
                        if (($service_id == 904 || $service_id == 724) && !empty($summ)) {
                            $contract = self::billingGetContract($service_id, $summ, $response);
                            if (isset($contract)) {
                                $dtm_contract = self::createContract($contract, $payer->id);
                                if (isset($dtm_contract)) {
                                    $invoice = self::billingGetInvoice($service_id, $payer, $contract);
                                    if (isset($invoice) && !empty($invoice)) {
                                        $dtm_invoice = self::createIn($imie, $service_id, $abitur_id, $payer['id'], $invoice, $dtm_contract);
                                        if (isset($dtm_invoice)) {
                                            return ['status' => 1, 'serial' => $dtm_invoice['serial']];
                                        }
                                    }
                                }

                            }
                        }

                    }
                }
            }
        }
    }

    public static function getPerson($imie)
    {
        $person = Person::find()
            ->select(['person.*', 'my_user.imie'])
            ->joinWith('user')
            ->where(['person.imie' => $imie])
            ->asArray()
            ->one();
        return $person;
    }

    public static function billingGetPayer($person, $type = 1)
    {
        $username = "wey8shWSmogKSKVQWBdAMUY5UEBYs2";
        $password = "";
        $url = 'https://api.billing.birdarcha.uz/v2/payer';
        $result = [
            "name" => $person['lname'] . ' ' . $person['fname'] . ' ' . $person['mname'],
            "phone" => (string)$person['user']['username'],
            "type" => $type,
            "passport" => $person['psser'] . '-' . $person['psnum'],
        ];
        $client = new Client();
        $response = $client->createRequest()
            ->setMethod('POST')
            ->setFormat(Client::FORMAT_JSON)
            ->setUrl($url)
            ->setData($result)
            ->setHeaders([
                'Authorization' => 'Basic ' . base64_encode("$username:$password")
            ])
            ->setOptions([
                'timeout' => 50,
            ])
            ->send();
        if ($response->getIsOk()) {
            return $response->data;
        } else {
            return ['error' => true, 'message' => 'billing  payer not response'];
        }
    }

    public static function createPayer($data, $imie)
    {
        $username = self::getPerson($imie);
        // prd($username);
        $model = new Payer();
        $model->name = $data['name'];
        $model->payerId = $data['id'];
        $model->phone = $username['user']['username'];
        $model->type = (int)$data['type'];
        $model->imie = $imie;
        $model->passport = $data['passport'];
        $model->updated_at = date('Y-m-d H:i:s');
        $model->created_at = date('Y-m-d H:i:s');
        if ($model->save()) {
            return $model;
        } else {
            prd($model->getErrors());
        }
    }

    public static function billingGetContract($service_id, $summ, $response)
    {
        $username = "wey8shWSmogKSKVQWBdAMUY5UEBYs2";
        $password = "";
        $urlcontract = 'https://api.billing.birdarcha.uz/v2/contract';
        $resultcontract = [
            "number" => $service_id . ':' . $response['id'] . ':dtm_' . $service_id,
            "payerId" => $response['id'],
            "departmentId" => 2461,
            "issueDate" => date('Y-m-d'),
            "amount" => $summ,
            "note" => $summ . "so'mlik test",
        ];
        $clients = new Client();
        $responsecontract = $clients->createRequest()
            ->setMethod('POST')
            ->setFormat(Client::FORMAT_JSON)
            ->setUrl($urlcontract)
            ->setData($resultcontract)
            ->setHeaders([
                'Authorization' => 'Basic ' . base64_encode("$username:$password")
            ])
            ->setOptions([
                'timeout' => 50,
            ])
            ->send();
        if ($responsecontract->getIsOk()) {
            return $responsecontract->data;
        } else {
            prd("error contract");
        }
    }

    public static function createContract($data, $payer_id)
    {
        $contract = new Contract();
        $contract->number = $data['number'];
        $contract->payer_id = $payer_id;
        $contract->payerName = $data['payerName'];
        $contract->note = $data['note'];
        $contract->amount = $data['amount'];
        $contract->currency = $data['currency'];
        $contract->departmentName = $data['departmentName'];
        $contract->issue_date = $data['issueDate'];
        if ($contract->save()) {
            return $contract;
        } else {
            prd($contract->getErrors());
        }
    }

    public static function billingGetInvoice($service_id, $data, $contract = null)
    {
        $username = "wey8shWSmogKSKVQWBdAMUY5UEBYs2";
        $password = "";
        $urlin = 'https://api.billing.birdarcha.uz/v2/invoice';
        $contract_id = '';
        if ($service_id == 904 || $service_id == 724) {
            $contract_id = $contract['id'];
        }
        $serviceName = Service::find()->where(['code' =>$service_id])->asArray()->one();
        $results = [
            "requestId" => $service_id . ':' . $data['payerId'] . ':dtm',
            "serviceId" => $service_id,
            "departmentId" => 2461,
            "payerId" => $data['payerId'],
            "contractId" => $contract_id,
            "quantity" => 0,
            "note" =>$serviceName['note'],
            "paymentTerms" => "NET 180",
        ];
        $clients = new Client();
        $responseone = $clients->createRequest()
            ->setMethod('POST')
            ->setFormat(Client::FORMAT_JSON)
            ->setUrl($urlin)
            ->setData($results)
            ->setHeaders([
                'Authorization' => 'Basic ' . base64_encode("$username:$password")
            ])
            ->setOptions([
                'timeout' => 50,
            ])
            ->send();
        if ($responseone->getIsOk()) {
            return $responseone->data;
        } else {
            prd($responseone->getData());
        }
    }

    public static function createIn($imie, $service_id, $abitur_id, $payer, $data, $contract = null)
    {
        $contract_id = '';
        if ($service_id == 904 || $service_id == 724) {
            $contract_id = $contract->id;
        }
        $invoice = new DtmInvoice();
        $invoice->payer_id = $payer;
        $invoice->requestId = $data['requestId'];
        $invoice->serviceId = $data['service']['name'];
        $invoice->department = $data['department']['id'];
        $invoice->service_id = $service_id;
        $invoice->contract = $contract_id;
        $invoice->imie = $imie;
        $invoice->abitur_id = (string)$abitur_id;
        $invoice->inviceId = $data['id'];
        $invoice->fee = $data['fee'];
        $invoice->pay = 0;
        $invoice->balance =(string)$data['balance'];
        $invoice->bankAccount = $data['bankAccount'];
        $invoice->budgetAccount = $data['budgetAccount'];
        $invoice->status = $data['status'];
        $invoice->bank = $data['bank']['name'];
        $invoice->service = $data['service']['name'];
        $invoice->issueDate = $data['issueDate'];
        $invoice->expireDate = $data['expireDate'];
        $invoice->createdAt = $data['createdAt'];
        $invoice->createdAt = $data['createdAt'];
        $invoice->updatedAt = $data['updatedAt'];
        $invoice->note = $data['note'];
        $invoice->discounts = $data['discounts'];
        $invoice->serial = $data['serial'];
        $invoice->json = $data;
        if ($invoice->save()) {
            return $invoice;
        } else {
            return ['status' => 0, 'invoice' => $invoice->getErrors()];
        }
    }

    public function getSerial($serial){
        $username = "wey8shWSmogKSKVQWBdAMUY5UEBYs2";
        $password = "";
        $url = 'https://api.billing.birdarcha.uz/v2/invoice/'.$serial;
        $client = new Client();
        $response = $client->createRequest()
            ->setMethod('GET')
            ->setFormat(Client::FORMAT_JSON)
            ->setUrl($url)
            ->setHeaders([
                'Authorization' => 'Basic ' . base64_encode("$username:$password")
            ])
            ->setOptions([
                'timeout' => 50,
            ])
            ->send();
        if ($response->getIsOk()) {
            if (isset($response->data) && !empty($response->data)){
                // prd($response->data);
                $invoce = DtmInvoice::findOne(['serial'=>$serial]);
                $invoce->balance =(string) $response->data['balance'];
                $invoce->updated_at = date('Y-m-d H:i:s');
                if ($invoce->save()){
                    echo "okey";
                }else{
                    prd($invoce->getErrors());
                }
            }
        } else {
            return ['error' => true, 'message' => $response->getData()];
        }
    }
     // public function  setTe(){
     //     $data = DtmInvoice::find()->select('serial,pay,createdAt,balance,updated_at')->where(['between', 'createdAt', "2022-01-20", "2022-02-05" ])->andWhere(['pay'=>0])->andWhere(['balance'=>'0'])->andWhere(['updated_at'=>null])->limit(300)->asArray()->all();
     //     // prd($data);
     //     // sleep(6)
     //     foreach ($data as $key   => $value) {
     //         \Yii::$app->invoice->getSerial($value['serial']);
     //     }
     // }
     public function  setDelete($serialId){
         $username = "wey8shWSmogKSKVQWBdAMUY5UEBYs2";
         $password = "";
         $url = 'https://api.billing.birdarcha.uz/v2/invoice/reject?id='.$serialId;
         $client = new Client();
         $response = $client->createRequest()
             ->setMethod('DELETE')
             ->setFormat(Client::FORMAT_JSON)
             ->setUrl($url)
             ->setHeaders([
                 'Authorization' => 'Basic ' . base64_encode("$username:$password")
             ])
             ->setOptions([
                 'timeout' => 50,
             ])
             ->send();
         if ($response->getIsOk()) {
                 $invoce = DtmInvoice::findOne(['inviceId'=>$serialId]);
                 $invoce->status ='CANCELED';
                 $invoce->discounts = '0';
                 if ($invoce->save()){
                     echo "okey";
                 }else{
                     prd($invoce->getErrors());
                 }
         } else {
             return ['error' => true, 'message' => $response->getData()];
         }
     }
//      public function  setTe(){
// // //        $arr = [10195067494261 ,10249106104467,10512521767698,10514224854478,10701693126740,10714427124336,10735666643556,11468585356709,11520730228131,11577046384267,11609269650689,11645893107777,11677394969366,11718554073771,11872599983363,11915258522566,11980831244429,12104826092945,12154300809312,12163913250115,12329456152647,12371948396882,12401748847830,12455738566638,12457549877703,12513794423262,12553069102308,12599271400503,12684018032549,12730929445074,12748815659730,12783777919301,12850540378707,13075084608201,13113502893069,13303088723855,13381743144177,13587865618219,13617591226586,13720131451397,13984881283899,14286134638429,14497668963840,14502197731430,14540748323995,14548664089253,14598707894587,14644886917163,14656577974385,14697653439307,14698094654112,14714479575480,14784754973034,14805047713613,14883749454490,15407790908533,15424349552893,15445723979719,15477165515821,15821568210784,15931615390467,16028101351152,16209902580946,16210612528158,16275095750566,16324098423727,16335630003106,16431888404586,16473369691423,16887826471248,16924052123631,16953552208039,17022028343746,17053300760060,17065831810990,17066639596940,17084031409982,17105883738815,17207672755777,17269950294911,17297030277463,17370957609139,17642741040063,17718537255599,17830938480815,17936420499239,18064242142828,18075159478198,18161885233414,18298180263466,18306573195401,18334162485165,18500541809342,18646086940285,18650602627641,18895357923005,18940100665320,19024446964961,19161478457282,19175420117393,19213909597780,19434991712843,19457643364528,19626521473497,19717347768201,19909038483729,19940247102264,19952152397019,19981927171939,20137270709587,20269170224956,20393307165312,20490377893685,20511757258693,20534671085647,20539113725281,20672905626400,20737207162847,20867088973182,20900844816452,20944972093995,21089260309930,21186367151988,21187134519312,21192359334670,21262883019888,21291448402272,21339926106291,21407536897833,21413120258307,21433999108467,21469680511769,21477241859866,21483567344737,21618172556017,21692722012851,21712469979267,21766849356507,21819231297517,21853446377593,21961542489886,22039375612445,22143817961033,22160281600277,22204687679557,22217796255977,22302325343073,22317295643925,22333977285320,22373177615032,22519254587507,22611259532851,22694148475671,22786921889973,22846642971330,22979548606952,23018379650729,23247320868665,23333588197124,23367443886069,23560918711938,23595578643255,23603551545794,23731968521621,23963297188148,23966372009068,23976989972123,23978028835284,24000981118569,24424560679236,24621664895491,24645167491085,24885947231369,24933451632175,25019167589952,25073662373674,25219118887311,25306622201650,25316160503064,25358432897784,25398091038680,25565622964158,25685514421973,25731031759294,25753439683176,25792219400049,26166009740662,26166998730870,26280490122642,26353079676939,26362124656577,26440289414221,26615269258304,26686334907246,26727320265891,26976320461027,27121675371760,27132970285147,27157792518401,27206948907251,27224987361453,27282942150514,27287302897182,27316973919698,27436034548941,27756527320636,27823889893454,27898582074439,27992501535911,28054906272025,28057625248760,28124309872977,28147346053832,28158338643011,28360942489579,28471598721930,28599224095214,28799621018295,28872132910286,29072081054649,29171647518623,29255673144765,29266448998391,29332668906382,29448935648753,29481507811220,29576704222773,29577421060720,29710076868265,29729948944742,29768005748431,29933686412128,30011538162256,30027095170283,30084599738379,30207287058760,30335511413295,30595616746212,30898557546367,31014556182949,31043163820576,31084669188061,31223677144280,31324950332607,31346804191264,31500314456477,31561413563290,31665511347852,31720641584965,31832477508418,31872718458815,31981690006303,32087516172137,32247672917589,32255802116473,32291124473197,32293837852205,32301241067775,32335310681838,32358797616862,32541902453402,32546826666614,32716241409670,32760879589838,32766081608413,32823561375912,32863470542531,32867994589200,33211090715794,33229782171830,33263231289866,33299511704089,33509756250958,33517145710122,33559477819301,33587076389811,33627679291787,33762476820280,33790017948901,33812340941678,33973123206918,34041422318558,34117734897807,34195677402511,34263313184568,34557137466176,34571093565775,34886315075169,34948842648713,34992379123399,35273942957766,35614976022512,35683897569474,35723897008994,35734977756660,35769551770475,35782340207987,35806750330059,35894940639353,36269065033156,36556062955253,36669710170262,36681611727722,36794724293042,36805688339829,36926504395965,36958901099204,36974507635999,37034161960568,37127162501054,37132032124755,37244057564569,37285678004655,37309280205865,37318326050369,37388012257301,37388564458233,37390791594091,37425730742358,37451999724655,37475532770231,37486876850005,37518572803116,37575272340068,37702094256083,37722570276949,37726147352246,37866854640888,37868983894966,37957347052010,38008083543039,38080047101112,38183363536319,38239706361993,38253514684609,38415022775618,38556636280136,38605696860767,38803754666029,38806772223993,38808587103701,38898985648262,38927212910214,39193782573867,39389797635381,39456662065783,39459013002527,39606249000742,39664821036052,40026672863410,40067891875798,40087248554176,40252204313321,40389552345594,40419315246788,40498960419883,40519623542960,40572986627769,40789470894254,41058543506600,41073860709354,41101206723069,41115947533360,41146428092228,41152048457298,41208788800672,41322591875378,41327762209033,41357364190517,41411066497892,41454417263801,41466959685931,41657267230519,41687383520660,41820423978993,41922671620362,41927285154200,41952246407421,42080189121795,42309445134519,42385371770218,42446634042882,42478966126667,42534862551673,42543054302849,42704550598162,42751173380329,42765216611576,42873171821345,42881431541298,42911037486204,43086386797649,43150645648203,43186559499180,43190504625397,43236929250966,43415823240413,43439919909510,43524148018246,43578283230289];
// // //         $arr =[43583569867481 ,43594379838373,43668825959657,43797281876063,44007817844385,44228431088964,44267266457888,44371630272199,44482791285975,44601881838111,44654715367204,44731216951447,44792061820419,44805196654651,44843193707650,45083059288737,45092963836539,45111554311495,45151373830293,45163481952524,45214268290243,45263481495801,45264772627853,45270137654664,45337099520458,45733266863197,45865768824850,45930383340344,45931337604823,45973945227478,46012468396194,46088906166747,46130968937395,46269491111261,46398612821007,46507847623692,46534105093598,46539499197276,46658980449212,46835720930966,46840848082884,46875108374631,47017582519816,47042883628391,47138629778881,47174411036915,47194704363539,47213358867850,47217925500954,47218026528084,47398417138140,47400615299132,47473913508634,47622901231932,47728412328783,47903761631965,47977990807713,48007136583073,48168387835466,48169059219660,48192801901110,48204790250963,48231402613390,48269940129489,48288777429787,48371196967614,48390193566364,48405045712337,48431061091499,48531878640648,48606424962496,48657662471692,48719123369666,48896750642873,48903201210350,48949704955399,48954257265170,49038688275673,49123778027861,49471785456439,49490931530568,49599117641995,49632139995972,49762795044190,49814484008605,49943070283174,49963155657854,49973132196033,49995328272959,50038318814247,50123505721719,50349214890903,50363446532966,50427203113480,50447343964497,50658255315751,50675075496825,50826595762341,50843860849548,50943596137671,51156182318412,51158563538139,51292739004600,51475725864227,51529558671624,51548726035664,51588258075480,51751387524558,51845531996408,51869353637645,52036801689317,52037104733527,52129805108989,52244164198361,52305789962374,52389076670329,52426750066943,52513422264680,52527669909023,52777853261777,52853167181902,52934381682884,52937204822849,52975873547640,52989322617771,53088835247028,53169747993140,53283459757070,53284166141327,53285091803670,53745389289491,54249034857279,54357326827044,54460125572805,54488256059995,54689924561136,54712967461402,54729492104864,54894281723524,55187997570758,55278074225725,55392648650835,55444524355929,55510212502807,55528304436279,55599633751286,55641803899324,55676243722558,55689690169713,55691631361987,55813551598088,55862834987989,56039549430048,56170429590782,56229820573287,56256371404598,56265601895770,56309833950467,56498261218837,56519247466951,56555686573060,56565485200710,56575621965723,56608188303420,56609185994903,56678515357913,56758275748362,56766396715968,56817098052893,56926662687241,56994245034548,57068685621377,57130097197923,57211100437598,57323965733249,57385051338092,57458410347979,57500102237836,57554423210703,57682581380011,57707146217178,57816729802626,57876401883165,58067555963020,58186703917142,58190050906519,58212792621625,58314735168882,58331790159767,58379305114879,58641338192298,58675486086504,58708922151983,58725678886712,58728947280371,58807701955248,58942108341838,58990092883621,59033966691143,59154925452013,59278735384163,59314551098948,59437633937652,59527175067341,59557582933059,59840271227564,60062189992853,60248173502590,60373202990847,60462669207711,60688060351802,60832013421010,61206166099002,61252189082997,61393098093607,61488239672486,61580985823884,61604321275864,61616041283755,61664301334488,62100245714562,62316040137980,62388544368705,62480424168522,62490400299205,62520939945310,62616652411469,62631148960516,62632425098002,62634330448361,62754796066651,62799178410497,62799660136457,62844666084969,62903048448380,62965257427530,63012526308984,63103034418298,63304093867201,63328908386337,63474587135565,63600656495235,63626116674845,63629587051560,63642045679201,63662914302113,63690724652336,63710015910661,63731343089147,63874291305212,64039391995478,64084063048361,64286627829235,64303044346942,64303362203844,64310519258195,64353422372066,64367311691047,64536265987590,64567210166820,64681095620144,64718698715899,64925582996663,65099344539340,65164749414472,65458345900372,65475976708222,65522218804275,65698138577594,65808349287272,65875344637636,66160212457495,66371523939618,66481832427671,66592759274013,66695093333043,66726949550846,66848293242822,66968989313728,66988607584448,67041811402624,67091767044053,67127955741687,67154995420227,67504810639447,67652431195176,67729384504120,67755095248795,67919070614428,67963498701364,68015633746573,68067950929230,68197215668162,68214254085670,68338881371268,68368976514365,68477778081900,68511211529408,68558076541889,68575943834117];
// // //         $arr = [68605866231088 ,68674831129596,68680746959946,68778932129004,68817308779322,68843145120202,68909732417188,68996192424681,69311026631992,69400615994853,69409097282176,69480155663502,69526621388282,69551348824300,69654029011099,70090949664596,70123305152749,70168597442088,70284724695711,70429912356624,70509737142614,70672122605173,70693337388643,70833455679565,70851278206915,70860914672819,70911074257433,70925106468419,70966861789198,70993353860444,71095232702863,71162191000312,71164141313578,71170389806309,71283874614983,71408719968577,71450125829121,71463694538990,71482067729052,71558170366506,71839753859911,71947773455472,72017014208424,72191613331666,72241380698474,72270161270446,72334176285049,72334564445147,72436740003220,72658729425226,72733894451367,72965128598181,73016121788291,73027550105147,73089159522069,73089466574776,73222167632321,73382816340441,73395369285947,73482448007170,73545472163926,73594378564257,73608066629889,73616343583544,73708521578873,73915766310436,73939204076411,74040345454035,74136336830785,74145461709196,74182044396116,74209207593674,74213405529005,74222902290212,74302245831566,74352680230906,74838020631926,74961785280991,75197758162958,75367681539659,75399955469907,75476944400203,75513896700633,75575547678581,75638090779391,75738361866257,75835440143683,75845813958136,75852106640786,75885191723949,75889678523709,75986126049077,75986239435140,76037398234486,76131953416850,76234557873976,76312561032870,76436535740750,76520576513839,76527058824471,76685216528520,76718325631995,76734266638461,76798911444119,76829232996403,76887673854419,76889231974087,76963150674299,77018531443349,77076515327355,77162847946498,77165176548764,77167735060808,77205678116746,77305144608790,77359999730235,77369821284085,77375218820098,77661054847565,77666295343958,77685203892308,77736109707675,77741839869477,77788812954734,77935293276227,78086567492744,78154076234700,78294353322763,78433852276157,78607723827166,78623911647804,78654864189570,78722536678287,78777402694202,78933933617664,78955700233546,78972851195369,79030802621900,79046870863406,79154763059839,79271219453268,79348996567576,79433288242444,79474904944467,79476066366467,79529422663691,79550958626715,79562605146032,79703722878296,79718040009021,80243356622367,80402222224048,80454075963285,80463678766207,80506737178887,80642744845655,80786632249222,80805327860774,80815630373406,80972613209086,81243520808251,81334293449228,81404148502353,81739123060849,81764344529760,81835204186091,81899151382599,81941669845455,81968555499088,82036112399690,82173373710291,82187968757356,82497196573697,82532902752996,82544065723551,82558141791491,82648136313122,82846097494260,83037165712558,83174064446401,83262868721476,83405856351740,83410442540287,83586280397536,83599649895871,83741932237984,83808091105344,83829283958583,83930692392132,83981072338604,84049176788727,84067468153123,84149689480880,84187361171811,84209061509411,84211013623529,84271942284782,84288828806711,84307906334343,84341676775013,84481945662977,84580893994704,84757405873840,84810715315444,84913725052613,85109562565164,85307184622379,85426443957039,85536875541826,85619043646363,85686251232326,85705881982351,85709010199567,85718736702716,85814050687924,85845158763121,85900720855408,85935264424649,85936287863399,86006450329608,86212047638977,86216923430327,86240107096418,86349488105918,86352413138730,86409527541225,86412577563491,86465603829846,86585456270449,86597534603455,86836306952005,86912876250221];
// // //            $arr = [87148513887265 ,87296483439284,87381053038121,87452521134537,87563059994435,87671587832034,87682155832980,87752285882283,87841786972556,87916869024097,87969451409808,88090001317421,88154005887372,88228166295430,88249017867113,88277201102559,88278261817704,88305852371276,88322312289653,88376549923426,88396440379675,88534669559025,88582021676108,88590429925026,88634965820915,88736636212269,88751720382412,88820085272777,88915708139805,89121712228133,89128534316959,89159511343864,89192661008428,89217847668063,89402107911896,89610591121590,89865138984236,89873961313253,89928768775078,89952894559916,90273654396114,90398657958077,90440121961106,90558614819898,90570654581323,90573164857747,90634457906554,90705361437497,91000299147693,91021916150479,91097371767386,91122603711898,91269540145953,91353810195821,91376091871027,91395191085053,91431155598179,91432600262229,91484383367177,91530480446084,91599431271507,91629273890686,91635932297036,91705458391147,91801635278176,91861880461513,91912060851743,92024004165871,92072267491570,92089126705598,92127759797458,92197953073951,92249017819862,92278219109783,92407973795936,92507608698130,92763472936073,92788325477066,92898777122479,92924703615343,92994653863197,92998260998081,93054693809356,93126286004198,93138762894889,93214981245680,93263773412395,93343398279200,93384741974540,93630916812947,93680970386206,93688696370214,93723895532157,93737872966520,93852783604440,93924772583330,93955336869294,94129536138347,94180689282083,94200009552751,94241368198113,94278072344602,94351819998787,94363078802852,94599659456069,94874457290227,94884870067384,94935389544594,95024500933137,95060535177521,95185285654979,95187548685983,95204563620008,95318818020976,95793630064562,95899944747648,95946105118520,96007999639716,96038313598841,96048425266449,96127428727564,96259646417936,96453340110215,96643775604651,96655910966209,96685277057228,96803796742366,96913359219793,97029124880720,97291360179390,97313980766797,97564098659513,97675133217247,97773096106331,98003249601011,98023153232072,98121821460474,98166735015835,98209619847775,98384067283484,98413028160321,98761238306716,98858246898721,98882957288750,98990537886058,99057562140684,99065466977972,99234095411075,99306946220227,99321746499965,99350286916098,99463284647638,99585203412182,99596033585517,99629235284557,99853884142558,99996455072213];
// // //         $arr = [23247320868665 ,23333588197124,23367443886069,23560918711938,23595578643255,23603551545794,23731968521621,23963297188148,23966372009068,23976989972123,23978028835284,24000981118569,24424560679236,24621664895491,24645167491085,24885947231369,24933451632175,25019167589952,25073662373674,25219118887311,25306622201650,25316160503064,25358432897784,25398091038680,25565622964158,25685514421973,25731031759294,25753439683176,25792219400049,26166009740662,26166998730870,26280490122642,26353079676939,26362124656577,26440289414221,26615269258304,26686334907246,26727320265891,26976320461027,27121675371760,27132970285147,27157792518401,27206948907251,27224987361453,27282942150514,27287302897182,27316973919698,27436034548941,27756527320636,27823889893454,27898582074439,27992501535911,28054906272025,28057625248760,28124309872977,28147346053832,28158338643011,28360942489579,28471598721930,28599224095214,28799621018295,28872132910286,29072081054649,29171647518623,29255673144765,29266448998391,29332668906382,29448935648753,29481507811220,29576704222773,29577421060720,29710076868265,29729948944742,29768005748431,29933686412128,30011538162256,30027095170283,30084599738379,30207287058760,30335511413295,30595616746212,30898557546367,31014556182949,31043163820576,31084669188061,31223677144280,31324950332607,31346804191264,31500314456477,31561413563290,31665511347852,31720641584965,31832477508418,31872718458815,31981690006303,32087516172137,32247672917589,32255802116473,32291124473197,32293837852205,32301241067775,32335310681838,32358797616862,32541902453402,32546826666614,32716241409670,32760879589838,32766081608413,32823561375912,32863470542531,32867994589200,33211090715794,33229782171830,33263231289866,33299511704089,33509756250958,33517145710122,33559477819301,33587076389811,33627679291787,33762476820280,33790017948901,33812340941678,33973123206918,34041422318558,34117734897807,34195677402511,34263313184568,34557137466176,34571093565775,34886315075169,34948842648713,34992379123399,35273942957766,35614976022512,35683897569474,35723897008994,35734977756660,35769551770475,35782340207987,35806750330059,35894940639353,36269065033156,36556062955253,36669710170262,36681611727722,36794724293042,36805688339829,36926504395965,36958901099204,36974507635999,37034161960568,37127162501054,37132032124755,37244057564569,37285678004655,37309280205865,37318326050369,37388012257301,37388564458233,37390791594091,37425730742358,37451999724655,37475532770231,37486876850005,37518572803116,37575272340068,37702094256083,37722570276949,37726147352246,37866854640888,37868983894966,37957347052010,38008083543039,38080047101112,38183363536319,38239706361993,38253514684609,38415022775618,38556636280136];
// // //         $arr=[38605696860767 ,38803754666029,38806772223993,38808587103701,38898985648262,38927212910214,39193782573867,39389797635381,39456662065783,39459013002527,39606249000742,39664821036052,40026672863410,40067891875798,40087248554176,40252204313321,40389552345594,40419315246788,40498960419883,40519623542960,40572986627769,40789470894254,41058543506600,41073860709354,41101206723069,41115947533360,41146428092228,41152048457298,41208788800672,41322591875378,41327762209033,41357364190517,41411066497892,41454417263801,41466959685931,41657267230519,41687383520660,41820423978993,41922671620362,41927285154200,41952246407421,42080189121795,42309445134519,42385371770218,42446634042882,42478966126667,42534862551673,42543054302849,42704550598162,42751173380329,42765216611576,42873171821345,42881431541298,42911037486204,43086386797649,43150645648203,43186559499180,43190504625397,43236929250966,43415823240413,43439919909510,43524148018246,43578283230289,56609185994903,56678515357913,56758275748362,56766396715968,56817098052893,56926662687241,56994245034548,57068685621377,57130097197923,57211100437598,57323965733249,57385051338092,57458410347979,57500102237836,57554423210703,57682581380011,57707146217178,57816729802626,57876401883165,58067555963020,58186703917142,58190050906519,58212792621625,58314735168882,58331790159767,58379305114879,58641338192298,58675486086504,58708922151983,58725678886712,58728947280371,58807701955248,58942108341838,58990092883621,59033966691143,59154925452013,59278735384163,59314551098948,59437633937652,59527175067341,59557582933059,59840271227564,60062189992853,60248173502590,60373202990847,60462669207711,60688060351802,60832013421010,61206166099002,61252189082997,61393098093607,61488239672486,61580985823884,61604321275864,61616041283755,61664301334488,62100245714562];
// // //         $arr =[62316040137980 ,62388544368705,62480424168522,62490400299205,62520939945310,62616652411469,62631148960516,62632425098002,62634330448361,62754796066651,62799178410497,62799660136457,62844666084969,62903048448380,62965257427530,63012526308984,63103034418298,63304093867201,63328908386337,63474587135565,63600656495235,63626116674845,63629587051560,63642045679201,63662914302113,63690724652336,63710015910661,63731343089147,63874291305212,64039391995478,64084063048361,64286627829235,64303044346942,64303362203844,64310519258195,64353422372066,64367311691047,64536265987590,64567210166820,64681095620144,64718698715899,64925582996663,65099344539340,65164749414472,65458345900372,65475976708222,65522218804275,65698138577594,65808349287272,65875344637636,66160212457495,66371523939618,66481832427671,66592759274013,66695093333043,66726949550846,66848293242822,66968989313728,66988607584448,67041811402624,67091767044053,67127955741687,67154995420227,67504810639447,67652431195176,67729384504120,67755095248795,67919070614428,67963498701364,68015633746573,68067950929230,68197215668162,68214254085670,68338881371268,68368976514365,68477778081900,68511211529408,68558076541889,68575943834117,99996455072213];
// // //         $arr= [10047596618795 ,10080202375663,10559449501358,10632165539573,11070112537044,11115970801878,11132446658958,11249059707184,11327690683743,11368631786243,11397147581423,11446964510207,11551629352121,11718431480840,12955943583821,13330498589955,13802944964568,13879847299090,14416346577952,14425800846007,14462679394116,14713272512627,14869782553324,14896900345218,14905812214589,14962477108431,15045453510300,15656844014517,15675722451154,15699741866744,15956781324501,16035301973284,16088123965400,16263240542585,16815447317782,16994863799177,17033962095968,17484872403248,17618032865633,17642747553723,17675311040620,17957084199740,18263617416517,18514953826610,18914274174003,19117961805896,19155777562505,19208596988849,19221029933075,19322825800052,19333504905658,20500418241935,20689218182968,20916314948515,20939858098378,21172825226123,21271458112525,22088911434082,22438952414744,22636562309727,23120550353375,23289918117685,23341419385388,23806772028651,24198797039456,24417209202936,26008176655309,26024714083657,26532122690199,26582649470133,26792223673664,26917806026206,26995441154724,27074754072207,27443007061969,27775889097223,27899874031998,27997405048721,28631698922945,29387353539104,29455509353234,29570106256326,29701797106257,29803192006338,29935987011703,30123046507238,30494173838081,30535187623013,30536838200382,30642522843938,31213556601451,31862500649833,32490595630659,33030640973632,33333879744923,33675122346341,33702789314005,33823623157326,34208351985106,34446422804326,34491026059991,34504866926408,35408308917396,35992714430062,36149519574336,36186444190841,36196078536297,36240937413876,36574333180049,36787712910828,37322270533511,37330641968148,37618323762963,38045905676629,38299447367993,38414404856896,39004020493102,39068087261442,39459391496799,39629020755955,40066827142883,40267045332090,40673854578975,40805420197328,40832725239190,41750220944808,41780247860562,41941844086176,42014294251308,42238902120030,42726627985801,43126756622584,43192240080797,43222690594719,43777595351177,44149023021794,44192734452213,44291141084334,44591352999078,44593856872273,44617327387700,45121022139054,45280388817715,45451850681314,45526622394008,45539849087517,45635981056324,45768972667158,45971007025925,46017555805395,46101529676179,46667321217129,46699036998922,46911860005778,47033458108761,47191003859819,47462839388826,47542237590701,47553158636504,47988878406208,48080470904535,48657421197660,48959888003686,49018947111014,49110007970137,49147948426096,49199451310331,49344679177708,49945245517053,50050472069314,50193687543942,50424736703375,50844776792281,50911007657223,51863637334791,51892805009892,52225251678798,52560825141020,53011176561491,53198245697057,53200641843756,53440312593576,53665842635282,54210821662046,54815938658111,54905174616559,55199341049948,55327251435054,55395658834845,55625566027844,55732898634619,56077039192778,56310914934318,56621478969296,56872953507790,56977536075016,57006283699814,57061138406978,57082326940361,57670521982470,57699485793801,57711968771368,57845317708061,57857053439486,58165822621970,58339274221411,58397894979405,58446911045907,58563278514389,58567797747606,58577638888057,58617458131575,58916023886590,59182357130154,60086836597236,60220003495155,60469215069620,60484845817478,60980843474286,61043877815753,61219225507174,61266628923500,61607667200853,61759936385086,62161027116089,62555256247678,62600471448221,62689163531263,62759441134070,63091769689819,63136775524749,63227743724967,63430988222319,64020644258382,64063273481637,64078642155967,64740912171909,64846947229284,65242322913251,65835359765832,65941886298090,66175586938509,66522083858891,66650352962615,67158457214651,67521455769383,67526470934475,67596799012614,67877285917643,68183692381687,68311755466774,68334820600935,68465309303854,68483804636200,68493688461567,68628986000356,68629401427048,68789504169754,69069847645852,69687893009184,69717547770452,69884307922614,69896823336261,69918252607526,70243724633455,70679197420603,70695932966076,70936138696098,70947219493746,70986755071987,71003334162502,71124108719251,71198646364928,71425856173855,71444028636967,71578666637488,71696871617097,72470707684613,72512405704813,72607120980054,73179602579380,73225953379422,73435995865879,74011397636698,74103267378414,74135895076749,74630804025564,75047004863553,75137399551349,75361468455199,75363780021910,75631512754536,75722905694426,75732268840637,76954458204042,77394849279989,77424470768946,77766662990392,77829295862763,77980675253167,78364067037775,78401925241998,78623595945781,79247938523005,79763888129971,79945341292566,80044887463711,80181617686888,80260742134674,80714783842548,80736437416821,81048670313711,81398360398411,81599021467644,81872364304569,81977431968930,81999850969332,82076947462240,82539194055723,82694497134067,82892749561464,83491681150818,83526490055709,83684888212793,83736463394200,84034731791547,84472248228863,84715938566206,85084489224901,85112689431959,85531249452265,85684773747396,85838784362827,86251807609048,86283798002293,86558909395334,86628318623360,86943803672826,87167947514005,87207817211154,87568387766395,88013323700465,88150324420859,89113075239927,89229487070785,89755664321432,89813090501554,90019835125121,90208907185471,90217717359517,90452167904364,90582022759104,90783735080876,91045670780446,91228785036757,91460493733748,91463288120722,91991284103910,92201941235512,92224910187251,92267615950801,92473289983024,92520829457980,92602810402270,92656878893874,93502400985829,93895203193790,94534563957578,94810267315681,94876415872180,95177312501452,95391414450334,95520318746954,95686251264093,96096006112447,96105661401139,96369207835143,96410509415301,96718258931552,96856610101929,96912685172805,97270067339384,97597008508227,97982634423241,98212855014034,98235678971138,98341194948734,98433305899535,98532356091751,98583618135479,98706779581284,98814841601493,99793314295467];
// //         //  $arr = [85025371484811 ,85066266940397,85073480499153,85233601706932,85282876268783,85307484869454,85313893183577,86079623982397,86086395148287,86243295979724,86507721055206,86514861654494,86710574547340,86766199996338,86797820777025,86821535319399,86980922080749,87103240567036,87360507499029,87401123688014,87867990167903,88289479410434,88620059464023,88799825463962,89042269954029,89315954299142,89381286618200,89666309017879,89694335045689,89708381589612,89807312895328,90047760447913,90065921742084,90066229123201,90487112467575,90552065071939,90789101502379,91283387788197,91597144168849,91653838071661,92054527997999,92164389913811,92168234829735,92335395005691,92817511948938,93154651857320,93321660895217,93340947670608,93642190949729,93690262762586,93887135301599,93942944756378,94346530458045,94563733497412,94937248989348,94993541823216,95066185849816,95138142175411,95533459612006,95608677472469,95666367800761,95828357664611,96222846178209,96616037334605,97270029714070,97328974645091,97378380252944,97459031716129,97618043937661,97800253206362,97872022053502,98141736971246,98218845396738,98387067466502,98719624861405,99047880873337,99505982001365,99579413255938];
// // //         $arr = [12733760391692 ,13362854389096,17133181790662,17469441307321,18828721872870,21140715625618,21992464653525,24703445028145,24995422654618,26607876183645,27136517696586,27543437909191,27692040576906,29191286020469,29679516801819,30674297261352,32658681789469,32949575526088,37646841745606,38663533613482,39835208971731,40929844854515,40943955531820,41456287184684,41580018067392,43100100637914,43960276373493,44801909363381,45312230260129,47016760440626,47494109359719,47648790208621,48683220688788,48869871706781,48969366268933,49134857468022,50895457899593,51123250353944,52587659444175,52691526620357,52854224037985,53166973892747,53863972961099,54605997106778,55198447307592,56341617080608,56441133130212,58176430525755,59387032020895,60517754338720,61706650264105,64128122794193,64307436513167,64536082181494,64679317041603,67363225870338,69002181266065,69446880501457,69578336343863,70527629962269,70593838690902,71849434499562,72825193104799,73938094954172,73979330907278,74045898377529,75083382160539,77288635780595,78442231937747,78939061351349,79673093723731,79975992493365,82249135940132,82872247153473,83085693539978,83414569871397,84562274774918,85783981790151,86502161331508,87842392024070,88845871879044,92667137324123,93870407698092,94291447513518,94767730835563,97004665234459,97370558236363,98598218618571];
// // //         $arr = [11260837453312 ,11445846739377,12358593198532,12468642618876,12481609673198,12834367044774,13024545079279,13231850140425,13310618711298,14410302297399,14616751914284,15981262785975,16184343984983,17137974759893,17412257986697,17810335728795,18974955872993,19334934827198,19414683219374,19922173936054,20324091157067,20556327760291,20757591993702,21454325784972,22911739747296,23139957127444,23162145239958,24667199655554,25532494666036,25725724838834,26015571429988,26422059662430,26905757328988,28260773747645,28570121590556,28719871260611,29459846203703,29642835786287,29849721020864,30019484784750,30223856313610,31614570870063,31712890334780,32984846538746,33273961510755,33390485518840,34495503945191,34598285490306,34740407765584,35151129513977,35600579658317,36107159485914,36556780069179,38039608394341,38548290429475,39294738305962,40762240717216,40842787576810,41455605465375,42724017709088,43044390784095,43100267332719,43179762015063,43643096814638,45859658596848,46015457563949,46079870727332,46530487530912,47897781686383,48057179030285,48236150978107,48495171215055,48681678829858,49180575157951,49190721825062,49745500996635,49748881105377,50123957974690,50398724613541,50430002657511,50519523564291,50579832836012,51403683196925,52855449597255,52910331594756,53112582362280,53682530039981,54205164574826,54524925113998,55308723246277,55479885381023,55939838529184,56574780209561,58533989452987,59776995780091,60444529050306,60654673040992,61962626047741,62432223752233,62847440059952,63015857675148,63300504837610,63457939127964,63488402393415,63533427012224,63709211257635,64767763878499,64795717130327,65127138820218,65266841469449,65555986602977,66506433839979,66670971192638,66881654331226,68333203498400,68586867666567,69143380042661,69434624446881,69976284737278,70432621575443,70535082424200,70829050146576,71369774136275,71789440643808,72266347349279,72676844213645,72724273438965,72725037546234,73072251678152,73182462166533,73420055716593,73623699197502,73686786433598,73945508266281,74441989498186,74542147129144,74812546012844,75007654925460,75771177362266,76451068662181,77866123005421,77873810981635,78552580509571,79300583410563,80725174583682,80810903522005,80852776026589,80907998011833,80991564535482,81208791482781,81560905890798,82032921615383,82045505372543,82185991209993,82525952911847,83083964336274,83414569871397,85084233132874,85494873762767,85695365642161,86158531177648,86239996304358,86267010896194,87029191641273,87072681296127,87364983317266,88199086807593,90838031665769,90950057218020,90962312201931,91593780595443,91672613929863,92942996537834,92953647845765,93203824826198,95361144671122,96304988143781,96305572050415,96386467457816,96796504566573,96902609041429,96951302932083,97053386557339,98528423996173,98996215793245,99007885084617,99248681447644,99492756474148];
//                 $arr = [63938138591853 ,16795516296466,16286296850701,98669337198570,98857889443023,65916611876008,62630599816679,45487208363598,58281952090655];
//                 $data = DtmInvoice::find()->select('serial,pay,balance,discounts,status,inviceId')->where(['serial'=>$arr])->andWhere(['pay'=>0])->andWhere(['balance'=>'0'])->asArray()->all();
//         //  prd($data);
// // //          sleep(6)
//             foreach ($data as $key   => $value) {
//                 \Yii::$app->invoice->setDelete($value['inviceId']);
//             }
//      }
}